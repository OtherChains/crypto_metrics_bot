# pip install notion-client requests pandas
import os, requests, datetime as dt
from notion_client import Client

NOTION_TOKEN   = os.getenv("NOTION_TOKEN")       # paste your secret_***
DATABASE_ID    = os.getenv("NOTION_DB")          # copy from the database’s URL
today          = dt.date.today().isoformat()

notion = Client(auth=NOTION_TOKEN)

def defi_tvl():
    data = requests.get("https://api.llama.fi/tvl").json()
    return round(data["tvl"] / 1e9, 2)           # billions USD

def fear_greed():
    fg = requests.get("https://api.alternative.me/fng/?limit=1").json()
    return int(fg["data"][0]["value"])

# --- add similar helper funcs for the rest of your proxies ---
# CoinMetrics, BitInfoCharts, The Block ETF flows, etc.
# (Some require free API keys; leave placeholders if you’ll add later.)

payload = {
    "parent": {"database_id": DATABASE_ID},
    "properties": {
        "Date":            {"date": {"start": today}},
        "DeFi TVL":        {"number": defi_tvl()},
        "Fear-Greed":      {"number": fear_greed()},
        # "VC $ Deployed": ...,
        # repeat for remaining columns
    }
}

notion.pages.create(**payload)
print("Inserted metrics for", today)
